import{r as c,j as e}from"./react-CeYxiRmC.js";import{c as Le}from"./react-dom-YNBHO1N0.js";import{L as $e,H as Re}from"./react-router-dom-B4E_8cF8.js";import{a as x}from"./axios-CCb-kr4I.js";import{a as $,d as Te,e as N}from"./react-router-BaTOSbE1.js";import{A as H,S as le,C as T,F as a,I as w,B as I,a as ze,t as Ne,M as C,L as k,b as W,D as Ee,R as re,c as te,P as oe,d as Ae,e as Ue,T as Be,f as ae,s as y,g as De}from"./antd-DFHZq0Mf.js";import{J as O,L as ce,M as Me,N as We,R as _e,O as He,P as de,Q as Oe,S as qe,T as Ke}from"./@ant-design-CmW_vR5S.js";import{R as Ze,L as Ve,C as Ye,X as Ge,Y as Je,T as Xe,a as Qe,b as es}from"./recharts-BAER89sh.js";import"./classnames-BK5ccKcQ.js";import"./scheduler-CzFDRTuY.js";import"./@remix-run-Ct_VKm0J.js";import"./rc-util-iA3tCfDp.js";import"./react-is-DcfIKM1A.js";import"./@babel-De8Uv8Fu.js";import"./rc-resize-observer-BVBsaGzI.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-DlUss5QA.js";import"./@rc-component-Ckg4_mfF.js";import"./rc-notification-C-aNmDGe.js";import"./rc-tooltip-CoBpF6gT.js";import"./rc-overflow-DZJWIvlg.js";import"./rc-tabs-ButC1fIB.js";import"./rc-dropdown-Ug3DgDEt.js";import"./rc-menu-B3cZXPNn.js";import"./rc-select-BfQxUtT6.js";import"./rc-virtual-list-BFjFZgjn.js";import"./rc-checkbox-D_vtcrLU.js";import"./rc-input--od81QUQ.js";import"./@ctrl-DOFZgDuz.js";import"./rc-field-form-CA2bnUzH.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-dialog-UZIv2NWv.js";import"./rc-pagination-DtvwXmcl.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-picker-C1Q-AKR_.js";import"./rc-textarea-DnloJtqE.js";import"./copy-to-clipboard-iuHVwNMD.js";import"./toggle-selection-BHUZwh74.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./clsx-B-dksMZM.js";import"./lodash-JdW5wBwj.js";import"./tiny-invariant-BaFNuDhB.js";import"./d3-shape-DjFPhhqo.js";import"./d3-path-CimkQT29.js";import"./react-smooth-FvrhDJGA.js";import"./prop-types-CGJacfSb.js";import"./fast-equals-C7I1S-bJ.js";import"./victory-vendor-6_AdwBXU.js";import"./d3-scale-BYIooUZQ.js";import"./internmap-BkD7Hj8s.js";import"./d3-array-g_qRI3rN.js";import"./d3-time-format-BKO53YJi.js";import"./d3-time-QpEiTrED.js";import"./d3-interpolate-CvRPKVI0.js";import"./d3-color-9lF95FHy.js";import"./d3-format-CzD4bSOQ.js";import"./recharts-scale-DiOBu8nk.js";import"./decimal.js-light-B5-9uEc-.js";import"./eventemitter3-Cz_UUE-p.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&h(n)}).observe(document,{childList:!0,subtree:!0});function g(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(t){if(t.ep)return;t.ep=!0;const i=g(t);fetch(t.href,i)}})();const ss="/assets/react-CHdo91hT.svg";function rs({setState:d,setLoading:m}){const[g]=a.useForm(),{message:h}=H.useApp(),t=async u=>{console.log("Received values of form: ",u),m(!0);try{const l=await x.post("/api/user/register",u,{withCredentials:!0});console.log("register response: ",l.data),l.data==="success"?(h.success("Register successfully!"),d(!1)):h.error("Register failed!")}catch(l){console.error("Request Fail:",l),h.error("Register failed!")}finally{m(!1)}},i=async(u,l)=>{if(/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(l))try{if((await x.get(`/api/user/validateEmail?email=${l}`,{withCredentials:!0})).data==="success")return Promise.reject(new Error("This email is already registered!"))}catch(P){console.error(P)}else if(l&&l.length!==0)return Promise.reject(new Error("The input is not valid E-mail!"));return Promise.resolve()},n=async(u,l)=>{const b=/^[a-zA-Z0-9_-]{6,16}$/,P=/^[a-zA-Z0-9_-]*$/;if(b.test(l))try{if((await x.get(`/api/user/validateUsername?username=${l}`,{withCredentials:!0})).data==="success")return Promise.reject(new Error("This username is already registered!"))}catch(v){console.error(v)}else if(l.length!==0)return P.test(l)?Promise.reject(new Error("Username must be 6-16 characters long!")):Promise.reject(new Error("Username can only contain letters, numbers, underscores and hyphens!"));return Promise.resolve()};return e.jsxs(a,{name:"normal_register",className:"register-form",form:g,initialValues:{remember:!0},onFinish:t,scrollToFirstError:!0,children:[e.jsx(a.Item,{name:"email",validateDebounce:1e3,rules:[{required:!0,message:"Please input your E-mail!"},{validator:i}],hasFeedback:!0,children:e.jsx(w,{placeholder:"Email"})}),e.jsx(a.Item,{name:"username",hasFeedback:!0,validateDebounce:1e3,rules:[{required:!0,message:"Please input your Username!"},{validator:n}],children:e.jsx(w,{placeholder:"Username"})}),e.jsx(a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"},{min:6,message:"Password must be at least 6 characters!"}],hasFeedback:!0,children:e.jsx(w.Password,{type:"password",placeholder:"Password",minLength:6})}),e.jsx(a.Item,{name:"password2",dependencies:["password"],rules:[{required:!0,message:"Please input your Password again!"},({getFieldValue:u})=>({validator(l,b){return!b||u("password")===b?Promise.resolve():Promise.reject(new Error("Passwords do not match!"))}})],hasFeedback:!0,children:e.jsx(w.Password,{type:"password",placeholder:"Password again",minLength:6})}),e.jsxs(a.Item,{children:[e.jsx(I,{type:"primary",htmlType:"submit",className:"register-form-button",children:"Register"}),"Or ",e.jsx(I,{onClick:()=>d(!1),children:"login now!"})]})]})}function ts({setState:d,setLoading:m}){const g=$(),[h]=a.useForm(),{notification:t}=H.useApp(),i=async n=>{console.log("Received values of form: ",n),m(!0);try{(await x.post("/api/user/login",n,{withCredentials:!0})).data==="success"?(g("/index"),t.success({message:"Login successfully!",description:"Welcome to IoT Platform!"})):t.error({message:"Login failed!",description:"Please check your username and password."})}catch(u){console.error("Request Fail:",u),t.error({message:"Login failed!",description:"Please check your username and password."})}finally{m(!1)}};return e.jsxs(a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},form:h,onFinish:i,children:[e.jsx(a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}],children:e.jsx(w,{prefix:e.jsx(O,{className:"site-form-item-icon"}),placeholder:"Username"})}),e.jsx(a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}],children:e.jsx(w,{prefix:e.jsx(ce,{className:"site-form-item-icon"}),type:"password",placeholder:"Password"})}),e.jsx(a.Item,{children:e.jsx(a.Item,{name:"remember",valuePropName:"checked",noStyle:!0,children:e.jsx(ze,{children:"Remember me"})})}),e.jsxs(a.Item,{children:[e.jsx(I,{type:"primary",htmlType:"submit",className:"login-form-button",children:"Log in"}),"Or ",e.jsx(I,{onClick:()=>d(!0),children:"register now!"})]})]})}function os(){const d=$(),[m,g]=c.useState(!1),[h,t]=c.useState(!1);function i({state:u,setLoading:l}){return u?e.jsx("div",{className:"card",children:e.jsx(rs,{setState:g,setLoading:l})}):e.jsx("div",{className:"card",children:e.jsx(ts,{setState:g,setLoading:l})})}const n=async()=>{try{await x.get("/api/user/info",{withCredentials:!0}),console.log("info user success"),d("/index")}catch(u){console.log(u)}};return c.useEffect(()=>{n()},[]),e.jsx("div",{className:"home-container",children:e.jsxs(H,{className:"login-register",children:[e.jsx("div",{children:e.jsx("a",{href:"https://react.dev",target:"_blank",children:e.jsx("img",{src:ss,className:"logo react",alt:"React logo"})})}),e.jsx("h1",{children:"Price Comparison"}),e.jsx(le,{spinning:h,children:e.jsx(T,{hoverable:!0,className:"login-card",children:e.jsx(i,{state:m,setLoading:t})})}),e.jsx("p",{className:"index-footer",children:"星际飙车侠, Zhejiang University"})]})})}const as="/assets/jingdong-ByCbm6nK.svg",is="data:image/svg+xml,%3csvg%20class='icon'%20style='width:%20auto;height:%20auto;vertical-align:%20middle;fill:%20currentColor;overflow:%20hidden;'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='620'%3e%3cpath%20d='M52%20520c0%20258.464%20209.536%20468%20468%20468S988%20778.464%20988%20520%20778.464%2052%20520%2052%2052%20261.536%2052%20520z%20m24%200c0-245.216%20198.784-444%20444-444S964%20274.784%20964%20520%20765.216%20964%20520%20964%2076%20765.216%2076%20520zM855.552%20414.624c-5.808-20.72-12.848-34.656-25.024-41.44-10.944-6.432-23.792-1.92-37.248%209.632l-20.736%2023.728a278.976%20278.976%200%200%201-59.04%2053.264%20158.688%20158.688%200%200%201-85.28%2022.848H413.952a137.76%20137.76%200%200%201-85.376-29.536c-12.16-9.6-31.44-30.768-59.008-60.976-20.56-22.944-40.256-29.472-57.76-19.888-12.224%206.416-19.888%2020.72-25.024%2041.76a254.56%20254.56%200%200%200-4.512%2051.328v49.424h-1.28v93.712c0%2020.72%204.496%2035.904%2012.848%2046.624a48.544%2048.544%200%200%200%2034.656%2016.688h583.376a46%2046%200%200%200%2034.656-16.688c9.024-10.928%2012.224-26.32%2012.224-46.624v-143.136c0.928-16.96-0.16-34-3.2-50.72z%20m-557.76%20204.112c2.192%207.712%206.16%2014.816%2011.568%2020.72a65.12%2065.12%200%200%201-46.88-21.6%2068.176%2068.176%200%200%201-23.104-52.576%2071.6%2071.6%200%200%201%2023.104-53.104%2071.744%2071.744%200%200%201%2048.16-21.808c-4.48%202.592-9.008%209.632-12.832%2021.808a183.088%20183.088%200%200%200-6.32%2053.312c-0.528%2017.968%201.6%2035.904%206.32%2053.248z%20m70.624-0.88a71.136%2071.136%200%200%201-47.504%2021.872c5.36-5.952%209.312-13.04%2011.552-20.72%204.72-17.248%206.88-35.088%206.416-52.96a182.464%20182.464%200%200%200-6.416-53.248c-4.512-11.552-8.336-18.656-12.848-21.856a74.752%2074.752%200%200%201%2070.608%2075.104%2071.28%2071.28%200%200%201-21.808%2051.808z%20m129.52-68.64l9.008-1.92h27.568l9.008%201.92c1.92%201.92%201.28%204.512-1.296%206.432l-16.688%2023.728a5.184%205.184%200%200%201-4.496%201.92l-4.464-1.92-17.248-23.68a6.416%206.416%200%200%201-1.28-6.272l-0.112-0.208z%20m102.672%2096.928c-5.76%207.68-17.296%2012.176-34.608%2012.176-18.64%200-32.736-7.712-39.168-21.808l-1.28-1.296-4.512-1.92h-1.296l-4.464%201.92-1.28%201.28c-6.432%2014.112-20.736%2021.824-39.168%2021.824-17.312%200-29.536-4.512-34.672-12.16v-9.024a43.472%2043.472%200%200%200%2028.24%209.632c17.36%201.92%2029.536-3.2%2037.248-16.688%204.528-9.712%206.72-20.352%206.432-31.072h16.672l1.296%2012.16c1.248%209.024%201.92%2015.552%205.76%2018.656%207.712%2012.848%2019.888%2018.608%2037.248%2016.688a52.368%2052.368%200%200%200%2028.224-9.632l-0.672%209.28z%20m109.776-27.616c3.2%2010.368%206.432%2017.312%2010.368%2020.736a68.688%2068.688%200%200%201-46.624-21.2%2066.88%2066.88%200%200%201-21.824-52.576%2070.144%2070.144%200%200%201%2021.824-53.312%2074.592%2074.592%200%200%201%2048.128-21.808c-4.512%202.592-8.352%2010.368-11.552%2021.808a146.656%20146.656%200%200%200-7.728%2053.312%20146.56%20146.56%200%200%200%207.52%2053.248l-0.112-0.208z%20m69.312-0.672a67.04%2067.04%200%200%201-46.624%2021.872c4.464-3.216%207.68-10.368%2010.88-20.72%205.808-14.096%207.728-32.752%207.728-53.264s-1.92-39.168-7.728-53.248c-3.2-11.568-7.04-19.28-12.848-21.872a70.24%2070.24%200%200%201%2048.8%2021.872%2071.184%2071.184%200%200%201%2021.712%2053.552%2066.624%2066.624%200%200%201-21.808%2051.808h-0.112z'%20p-id='621'%3e%3c/path%3e%3c/svg%3e",ns="/assets/pdd-xspiMH1O.svg",{Header:ls,Content:ie,Footer:cs,Sider:ds}=k,{Search:ne}=w,ms=["搜索","商品库"].map(d=>({key:d,label:`${d}`})),ps=[{key:"pdd",icon:e.jsx("img",{src:ns,alt:"Taobao",style:{width:"36px",height:"36px"}}),label:"拼多多",style:{marginTop:"16px",marginBottom:"16px"}},{key:"jd",icon:e.jsx("img",{src:as,alt:"JD",style:{width:"36px",height:"36px"}}),label:"京东",style:{marginBottom:"16px"}},{key:"tmall",icon:e.jsx("img",{src:is,alt:"Tmall",style:{width:"36px",height:"36px"}}),label:"天猫"}],us=()=>{const[d,m]=c.useState("搜索"),[g,h]=c.useState("pdd"),[t,i]=c.useState(""),[n,u]=c.useState([]),[l,b]=c.useState([]),[P,v]=c.useState(!1),[f,S]=c.useState(1),r=8,R=f*r,F=R-r,A=n.slice(F,R),q=l.slice(F,R),[me,K]=c.useState(!1),[Z,V]=c.useState(null),[Y,G]=c.useState([]),[pe,J]=c.useState(!1),[z,ue]=c.useState(new Set),U=c.useRef({}),[he,X]=c.useState(!1),ge=1,{token:{colorBgContainer:B,borderRadiusLG:Q}}=Ne.useToken(),D=$(),xe=s=>{m(s.key)},ee=s=>{S(s),window.scrollTo({top:0,behavior:"smooth"})},fe=async s=>{console.log("Search:",s),i(s)},ye=async s=>{console.log("Database Search:",s),i(s)},je=s=>{h(s.key),S(1)},we=()=>{C.confirm({title:"确认要退出登录吗？",okText:"是",cancelText:"否",onOk(){try{const s=x.get("/api/user/logout",{withCredentials:!0});console.log("退出登录成功:",s)}catch(s){console.error("退出登录失败:",s),C.error({title:"退出登录失败",content:"请稍后重试。"})}D("/")}})};c.useEffect(()=>{t&&(d==="搜索"?Pe(t,g):d==="商品库"&&(console.log("搜索商品库"),be(t)))},[t,g,d]),c.useEffect(()=>{(async()=>{try{await x.get("/api/user/info",{withCredentials:!0})}catch(o){console.error("用户未登录:",o),C.error({title:"未登录",content:"请先登录。",onOk(){D("/")}})}})()},[]);const be=async s=>{v(!0);try{let p=(await x.get("/api/goods/database-search",{params:{keyword:s},withCredentials:!0})).data;p=p.map(j=>({...j,goodsPriceNum:M(j.goodsPrice)})),b(p),console.log("数据库搜索成功"),console.log(l),console.log(q)}catch(o){console.error("数据库搜索失败:",o),console.error("搜索失败，请稍后重试")}finally{v(!1),i("")}},M=s=>{const o=parseFloat(s.replace(/[^0-9.]/g,""));return isNaN(o)?0:o},Pe=async(s,o)=>{v(!0);try{let j=(await x.get("/api/goods/search",{params:{keyword:s,site:o,maxPage:ge},withCredentials:!0})).data;j=j.map(L=>({...L,goodsPriceNum:M(L.goodsPrice)})),u(j),console.log("搜索成功"),ve(j)}catch(p){console.error("搜索失败:",p),console.error("搜索失败，请稍后重试")}finally{v(!1),i("")}},ve=async s=>{for(const o of s)if(z.has(o.goodsUrl)){const p=U.current[o.goodsUrl];if(console.log("goodsUrl: "+o.goodsUrl+" previousPrice: "+p+" currentPrice: "+o.goodsPriceNum),p&&o.goodsPriceNum<p)try{const L=(await x.get("/api/user/getEmail",{withCredentials:!0})).data;await x.post("/api/user/sendPriceDropEmail",{email:L,productName:o.goodsName},{withCredentials:!0}),C.success({title:"降价提醒",content:`已向 ${L} 发送 ${o.goodsName} 降价通知邮件。`})}catch(j){console.error("发送降价邮件失败:",j)}U.current[o.goodsUrl]=o.goodsPriceNum}},se=(s,o)=>{s.preventDefault(),s.stopPropagation();const p=new Set(z);z.has(o.goodsUrl)?p.delete(o.goodsUrl):(p.add(o.goodsUrl),U.current[o.goodsUrl]=o.goodsPriceNum),ue(p)},Ce=async(s,o)=>{s.preventDefault(),s.stopPropagation(),V(o),K(!0),J(!0);try{const j=(await x.get("/api/goods/history",{params:{goodsId:o.goodsId},withCredentials:!0})).data.map(L=>({date:L.date,price:M(L.price)}));G(j),console.log("历史价格数据:",j)}catch(p){console.error("获取历史价格失败:",p),C.error({title:"获取历史价格失败",content:"请稍后重试。"})}finally{J(!1)}},Se=()=>{K(!1),V(null),G([])},ke=s=>{X(!!s)},Ie=()=>{D("/settings")},Fe=[{key:"settings",label:"设置",icon:e.jsx(de,{})},{key:"logout",label:"退出登录",icon:e.jsx(Oe,{})}];return e.jsxs("div",{className:"mainpage-container",style:{overflow:"auto"},children:[e.jsxs(k,{style:{minHeight:"100vh",flexDirection:"column",overflow:"auto",minWidth:"300px"},children:[e.jsxs(ls,{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx(Me,{style:{fontSize:"24px",color:"white",marginRight:"16px",cursor:"pointer"}}),e.jsx(W,{theme:"dark",mode:"horizontal",defaultSelectedKeys:["搜索"],selectedKeys:[d],onClick:xe,items:ms,style:{flex:1,minWidth:20}}),e.jsx(Ee,{menu:{items:Fe,onClick:({key:s})=>{s==="settings"?Ie():s==="logout"&&we()}},placement:"bottomRight",children:e.jsx(O,{style:{fontSize:"24px",color:"white",marginLeft:"auto",cursor:"pointer"}})})]}),d=="搜索"&&e.jsxs(k,{children:[e.jsx(ds,{breakpoint:"lg",collapsible:!0,collapsedWidth:"50px",collapsed:he,onBreakpoint:ke,trigger:null,style:{minWidth:"50px",background:B},children:e.jsx(W,{mode:"inline",defaultSelectedKeys:["pdd"],style:{height:"100%",borderRight:0},items:ps,onClick:je})}),e.jsxs(k,{style:{flex:1,maxWidth:"100%",minWidth:"250px",padding:"0 24px 24px"},children:[e.jsx(ne,{placeholder:"输入搜索内容",enterButton:"搜索",size:"large",onSearch:fe,loading:P,style:{marginBottom:"24px",marginTop:"24px"}}),e.jsxs(ie,{style:{margin:0,minHeight:280,background:B,borderRadius:Q,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",border:"1px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.09)",padding:"16px",boxSizing:"border-box",overflow:"auto"},children:[e.jsx(re,{gutter:[16,16],style:{flex:1,width:"100%",margin:0},children:A.map((s,o)=>e.jsx(te,{xs:24,sm:12,md:6,lg:6,xl:4,children:e.jsx("a",{href:s.goodsUrl,referrerPolicy:"no-referrer",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:e.jsx(T,{hoverable:!0,cover:e.jsx("img",{alt:s.goodsName,src:s.goodsImgUrl,style:{height:"200px",objectFit:"cover"},referrerPolicy:"no-referrer"}),style:{width:"100%"},children:e.jsx(T.Meta,{title:s.goodsName,description:e.jsx("span",{style:{color:"#1890ff",fontWeight:"bold"},children:s.goodsPrice})})})})},o))}),e.jsx("div",{style:{textAlign:"center",marginTop:"24px"},children:e.jsx(oe,{current:f,pageSize:r,total:n.length,onChange:ee,showSizeChanger:!1})})]})]})]}),d=="商品库"&&e.jsx(k,{children:e.jsxs(k,{style:{padding:"0 24px 24px"},children:[e.jsx(ne,{placeholder:"输入商品名称",enterButton:"搜索",size:"large",onSearch:ye,loading:P,style:{marginBottom:"24px",marginTop:"24px"}}),e.jsxs(ie,{style:{padding:24,margin:0,minHeight:280,background:B,borderRadius:Q,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",border:"1px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.09)",boxSizing:"border-box",overflow:"auto"},children:[e.jsx(re,{gutter:[16,16],style:{flex:1,width:"100%",margin:0},children:q.map((s,o)=>e.jsx(te,{xs:24,sm:12,md:6,lg:6,xl:4,children:e.jsx("a",{href:s.goodsUrl,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:e.jsxs(T,{hoverable:!0,cover:e.jsx("img",{alt:s.goodsName,src:s.goodsImgUrl,style:{height:"200px",objectFit:"cover"},referrerPolicy:"no-referrer"}),style:{width:"100%",position:"relative"},children:[e.jsx(T.Meta,{title:s.goodsName,description:e.jsx("span",{style:{color:"#1890ff",fontWeight:"bold"},children:s.goodsPrice})}),e.jsxs("div",{style:{position:"absolute",bottom:"8px",right:"8px",display:"flex",gap:"8px"},children:[e.jsx(We,{style:{fontSize:"20px",color:"#1890ff",cursor:"pointer"},onClick:p=>Ce(p,s)}),z.has(s.goodsUrl)?e.jsx(_e,{style:{fontSize:"20px",color:"#ff4d4f",cursor:"pointer"},onClick:p=>se(p,s)}):e.jsx(He,{style:{fontSize:"20px",color:"#1890ff",cursor:"pointer"},onClick:p=>se(p,s)})]})]})})},o))}),e.jsx("div",{style:{textAlign:"center",marginTop:"24px"},children:e.jsx(oe,{current:f,pageSize:r,total:l.length,onChange:ee,showSizeChanger:!1})})]})]})}),e.jsxs(cs,{style:{textAlign:"center"},children:["PCW ©",new Date().getFullYear()," Created by 星际飙车侠"]})]}),e.jsx(C,{title:Z?`${Z.goodsName} 的历史价格`:"历史价格",open:me,onCancel:Se,footer:null,width:800,children:pe?e.jsx("div",{style:{textAlign:"center"},children:e.jsx(le,{tip:"加载中..."})}):Y.length>0?e.jsx(Ze,{width:"100%",height:400,children:e.jsxs(Ve,{data:Y,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3"}),e.jsx(Ge,{dataKey:"date"}),e.jsx(Je,{dataKey:"price"}),e.jsx(Xe,{}),e.jsx(Qe,{}),e.jsx(es,{type:"monotone",dataKey:"price",stroke:"#8884d8",activeDot:{r:8}})]})}):e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"暂无历史价格数据。"})})})]})},{Header:hs,Content:gs,Sider:xs,Footer:fs}=k,{Title:E,Text:_}=Be,ys=[{label:"账户",key:"account",icon:e.jsx(de,{})},{label:"密码",key:"password",icon:e.jsx(ce,{})}],js=({refreshUserInfo:d})=>{const m=$(),[g]=a.useForm(),[h]=a.useForm(),[t]=a.useForm(),[i,n]=c.useState(!1),u=async S=>{try{const r=await x.post("/api/user/changeEmail",S,{withCredentials:!0});r.data==="success"?C.success({title:"修改成功",content:"邮箱修改成功！",onOk:()=>{g.resetFields(),d()}}):y.error({message:"修改失败",description:r.data})}catch(r){console.error("请求失败:",r),r.response&&r.response.status===401?(y.error({message:"请先登录！",description:"您尚未登录，请先登录！"}),m("/")):y.error({message:"修改失败！",description:r.message})}},l=async S=>{try{const r=await x.post("/api/user/changeUsername",S,{withCredentials:!0});r.data==="success"?C.success({title:"修改成功",content:"用户名修改成功！",onOk:()=>{h.resetFields(),d()}}):y.error({message:"修改失败",description:r.data})}catch(r){console.error("请求失败:",r),r.response&&r.response.status===401?(y.error({message:"请先登录！",description:"您尚未登录，请先登录！"}),m("/")):y.error({message:"修改失败！",description:r.message})}},b=async S=>{try{const r=await x.post("/api/user/delete",S,{withCredentials:!0});r.data==="success"?C.success({title:"删除成功",content:"账户删除成功！",onOk:()=>{t.resetFields(),n(!1),m("/")}}):y.error({message:"删除失败",description:r.data})}catch(r){console.error("请求失败:",r),r.response&&r.response.status===401?(y.error({message:"请先登录！",description:"您尚未登录，请先登录！"}),m("/")):y.error({message:"删除失败！",description:r.message})}},P=()=>{n(!0)},v=async(S,r)=>{if(/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(r))try{if(await(await fetch("/api/user/validateEmail?email="+r)).text()==="success")return Promise.reject("该邮箱已被注册！")}catch(F){return Promise.reject(F)}else if(r.length!==0)return Promise.reject("请输入有效的邮箱地址！");return Promise.resolve()},f=async(S,r)=>{if(/^[a-zA-Z0-9_-]{4,16}$/.test(r))try{if(await(await fetch("/api/user/validateUsername?username="+r)).text()==="success")return Promise.reject("该用户名已被注册！")}catch(F){return Promise.reject(F)}else if(r.length!==0)return Promise.reject("用户名必须为4-16个字符！");return Promise.resolve()};return e.jsxs(e.Fragment,{children:[e.jsx(E,{level:3,style:{borderBottom:"1px solid #e8e8e8",paddingBottom:"0.5rem",marginTop:"1rem"},children:"修改邮箱"}),e.jsxs(a,{form:g,initialValues:{remember:!0},onFinish:u,scrollToFirstError:!0,layout:"inline",style:{marginBottom:"3rem"},children:[e.jsx(a.Item,{name:"email",label:"新邮箱",validateTrigger:"onBlur",rules:[{required:!0,message:"请输入您的邮箱地址！"},{validator:v}],hasFeedback:!0,children:e.jsx(w,{})}),e.jsx(a.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",children:"修改"})})]}),e.jsx(E,{level:3,style:{borderBottom:"1px solid #e8e8e8",paddingBottom:"0.5rem"},children:"修改用户名"}),e.jsxs(a,{form:h,initialValues:{remember:!0},onFinish:l,scrollToFirstError:!0,layout:"inline",style:{marginBottom:"3rem"},children:[e.jsx(a.Item,{name:"username",label:"新用户名",hasFeedback:!0,validateTrigger:"onBlur",rules:[{required:!0,message:"请输入您的用户名！"},{validator:f}],children:e.jsx(w,{})}),e.jsx(a.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",children:"修改"})})]}),e.jsx(E,{level:3,style:{borderBottom:"1px solid #e8e8e8",paddingBottom:"0.5rem"},children:"删除账户"}),e.jsx(ae,{message:"一旦您删除了账户，将无法恢复。请谨慎操作。",type:"warning",showIcon:!0,style:{marginTop:"1rem",marginBottom:"1rem"}}),e.jsx(I,{type:"primary",danger:!0,icon:e.jsx(Ke,{}),onClick:P,children:"删除账户"}),e.jsxs(C,{title:"删除账户",open:i,footer:null,onCancel:()=>n(!1),children:[e.jsx(_,{strong:!0,children:"您确定要删除您的账户吗？"}),e.jsx(ae,{message:"此操作无法撤销！",type:"warning",description:"您所有的数据将被永久删除！",showIcon:!0,style:{marginTop:"1rem",marginBottom:"1rem"}}),e.jsx(_,{style:{fontWeight:"bold"},children:"请输入您的密码以确认："}),e.jsxs(a,{form:t,initialValues:{remember:!0},onFinish:b,scrollToFirstError:!0,layout:"vertical",style:{marginTop:"1rem"},children:[e.jsx(a.Item,{name:"password",rules:[{required:!0,message:"请输入您的密码！"}],hasFeedback:!0,children:e.jsx(w.Password,{type:"password",minLength:6,placeholder:"密码"})}),e.jsx(a.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",danger:!0,style:{width:"100%"},children:e.jsx("b",{children:"我确定要删除我的账户！"})})})]})]})]})},ws=()=>{const d=$(),[m]=a.useForm(),[g,h]=c.useState(!1),t=async i=>{h(!0);try{const n=await x.post("/api/user/changePassword",i,{withCredentials:!0});n.data==="success"?C.success({title:"修改成功",content:"密码修改成功！",onOk:()=>{m.resetFields()}}):y.error({message:"修改失败",description:n.data})}catch(n){console.error("请求失败:",n),n.response&&n.response.status===401?(y.error({message:"请先登录！",description:"您尚未登录，请先登录！"}),d("/")):y.error({message:"修改失败！",description:n.message})}finally{h(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{level:3,style:{borderBottom:"1px solid #e8e8e8",paddingBottom:"0.5rem",marginTop:"1rem"},children:"修改密码"}),e.jsxs(a,{form:m,initialValues:{remember:!0},onFinish:t,scrollToFirstError:!0,layout:"horizontal",style:{maxWidth:"400px"},labelCol:{span:8},wrapperCol:{span:16},children:[e.jsx(a.Item,{name:"oldPassword",label:"旧密码",rules:[{required:!0,message:"请输入您的旧密码！"}],hasFeedback:!0,children:e.jsx(w.Password,{type:"password",minLength:6,placeholder:"旧密码"})}),e.jsx(a.Item,{name:"newPassword",label:"新密码",rules:[{required:!0,message:"请输入您的新密码！"},{min:6,message:"密码必须至少6个字符！"}],hasFeedback:!0,children:e.jsx(w.Password,{type:"password",minLength:6,placeholder:"新密码"})}),e.jsx(a.Item,{name:"confirmPassword",label:"确认密码",dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0,message:"请确认您的新密码！"},{min:6,message:"密码必须至少6个字符！"},({getFieldValue:i})=>({validator(n,u){return!u||i("newPassword")===u?Promise.resolve():Promise.reject(new Error("两次输入的密码不匹配！"))}})],children:e.jsx(w.Password,{type:"password",minLength:6,placeholder:"确认密码"})}),e.jsx(a.Item,{style:{textAlign:"center"},children:e.jsx(I,{type:"primary",htmlType:"submit",loading:g,children:"修改"})})]})]})},bs=()=>{const d=$(),[m,g]=c.useState("account"),[h,t]=c.useState("未知用户"),[i,n]=c.useState("未知邮箱"),[u,l]=c.useState(!1),b=async()=>{l(!0);try{const f=await x.get("/api/user/info",{withCredentials:!0});t(f.data.username),n(f.data.email)}catch(f){console.error("请求失败:",f),f.response&&f.response.status===401?(y.error({message:"请先登录！",description:"您尚未登录，请先登录！"}),d("/")):y.error({message:"获取用户信息失败！",description:f.message})}finally{l(!1)}};c.useEffect(()=>{b()},[]);const P=f=>{g(f.key)},v=()=>{d("/index")};return e.jsx("div",{className:"settings-container",style:{overflow:"auto"},children:e.jsxs(k,{style:{minHeight:"100vh",flexDirection:"column",overflow:"auto",minWidth:"300px"},children:[e.jsxs(hs,{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",background:"#001529",padding:"0 24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Ae,{size:40,icon:e.jsx(O,{})}),e.jsx("div",{style:{marginLeft:10,maxWidth:"300px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:u?e.jsx(Ue.Input,{style:{width:200},active:!0,size:"small"}):e.jsxs(_,{strong:!0,style:{color:"white",fontSize:"16px"},title:`${h} <${i}>`,children:[h," <",i,">"]})})]}),e.jsx(qe,{style:{fontSize:"24px",color:"white",cursor:"pointer"},onClick:v})]}),e.jsxs(k,{children:[e.jsx(xs,{breakpoint:"lg",collapsible:!1,collapsedWidth:"0",style:{background:"#fff",minWidth:"150px"},children:e.jsx(W,{mode:"inline",defaultSelectedKeys:["account"],selectedKeys:[m],style:{height:"100%",borderRight:0},items:ys,onClick:P})}),e.jsx(k,{style:{padding:"24px"},children:e.jsx(gs,{style:{margin:0,minHeight:280,background:"#fff",borderRadius:"8px",display:"flex",flexDirection:"column",alignItems:"center",width:"100%",border:"1px solid #f0f0f0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.09)",padding:"16px",boxSizing:"border-box",overflow:"auto"},children:m==="account"?e.jsx(js,{refreshUserInfo:b}):e.jsx(ws,{})})})]}),e.jsxs(fs,{style:{textAlign:"center"},children:["PCW ©",new Date().getFullYear()," Created by 星际飙车侠"]})]})})},Ps=()=>e.jsx(De,{status:"404",title:"404",subTitle:"Sorry, the page you visited does not exist.",extra:e.jsx($e,{to:"/",children:e.jsx(I,{type:"primary",children:"Back Home"})})});function vs(){return e.jsxs(Te,{children:[e.jsx(N,{path:"/",element:e.jsx(os,{})}),e.jsx(N,{path:"/index",element:e.jsx(us,{})}),e.jsx(N,{path:"/settings",element:e.jsx(bs,{})}),e.jsx(N,{path:"*",element:e.jsx(Ps,{})})]})}Le(document.getElementById("root")).render(e.jsx(Re,{children:e.jsx(vs,{})}));
